from Crypto.Util.number import getPrime, getStrongPrime, bytes_to_long
from sympy import factorial
from random import randint

with open("flag.txt", "r") as file:
    flag = file.read().encode()

p, q = getStrongPrime(1024), getStrongPrime(1024)

def RSAgen(e = None):
    d = 0
    if not e:
        while(d.bit_length() < 2047):
            e = getPrime(2047)
            d = pow(e, -1, (p-1)*(q-1))
    else:
        d = pow(e, -1, (p-1)*(q-1))
    return (p*q, p, q, e, d)

n = p*q
print(f'{n = }')

key = RSAgen()
k = randint(600, 1200)
f = factorial(k)

leak = (pow(key[3], 2) + (key[3]*key[4] - 1)*f)*getPrime(256) + k

key = RSAgen(65537)
e = key[3]
flag = bytes_to_long(flag)
c = pow(flag, e, n)

print(f"{c = }")
print(f"{leak = }")


#OUTPUT
#
# n = 24177695623544040085174745338764509138803839467200248544809326049637794144744198898178975075294384442284002178698092662698305982153073971455350334431513096333593354385816833092048753718497022339040962588697074642930776054930806868735800605491488326339886188899922071436561182817020446668458712168648637309457659437626854990504405763383850729052511406767157844383418931841389070915396219304880025826299408102658543866450247975726924965408716409679764783340108563604952759451811075992362641390748517037475422912226589422991494020124617142577173142046038700188388666187615562584756480545102551423568107002828252121838661
# c = 19282130294804430059080570228545538938566149298881712908529120235113237050432104956858917019929397686120474121061046291710599394557693623432131198180908852386957357680113480813135341688298628677415945154045105281931615487408539242243983750936056351291108573489455138232415276068858329767705362534659787451658082348024809942971493270215705863247826731956405442094388588803898382566241949805841872402558654982031051516578208597990019049948473137679018520172882109073780710871439865148637315696575629733322848674371552679376303215478527473148941570826037254849641537933946374428667788947051546581204673913908681323363166
# leak = 1227422351238510763648511043748166601651971176644871510143397231050414037535547208787888692300172522241378215280639999740204192534277858544017151323186336829168810822492028108363708361204078605646773489753423652400688948577097751201592415321451218924924437592509448994392406163156097970496693282326791974967811145851515961541783704648233786634427617105021461778459176332321540781739119935598927514940062460587802575278746373570162766307605745788868062990596138149680211034646291024495823538001406058096471726804269999654170772686483167834886066622995623708485600218784411680026442315847428574526381409414043782649374313291186375375384056086829298014994925954682787113908548375031870684580594118221381288682328870052298347413771770922033415814177228040616793009858521320746652593156838236706704805387172815759538344813802111590959833651042518036304616530138026505957990354058536345656313107936584912742645968467386718468916592672680831500069788862891208002437309726570205874513053039073698117207761628471771426813470627123057132677430312421568993335657734738115882447225295652310574605214213205127756690641883484997166365870572628609150842886047470025410542597160271100949164893626741700321046547926661505260542887735367170181403642516534086870535845643850981582049580506595684274432404248646788547766486155120512312979444291698178347913737032547067721460839214324526398895381288979558286586597048878693633725900832886197898389434886172703473142421700984644036254452845779278539492038576118614033530526068896125803046133651984631183561273032509242558324928546262460721886444560421552301706071974159150396814823224871413521014485119743463982909049688311841828805473529953456995587889013432605959867894201606019061673150614771709223773163910284238184539549093245029475841198076162554031867294301054806150358413180230599234066523014432589004135467305887662256823294571112686562417020513405722734818134391863944165057473389396717033273408248081387389597627440764811397320369506280230238435520902524911383575642564049934357892435300504253737817114601466689444492156975742319488467941251171459203141767228279517679167171781042359874760043224167513397716090534159662340564845812162262979574450747803100023975236520098392553412240948081510786933647988886999779916483508312740544848007748490242740103340305915143131200706462904143391485462073156058439241673083619402217789500180825679060880451914966018629421197906329211062154033802857186998415011135259118879311008786698167587836645307989387220567800411233855958877311815493219560744088549360187003745110228752172205093462253072060944893629121072337023655422381953251734816933275897094034715958231051762849235809916643462551816049272968427113058709668616609314224371190057452964515141188487007824195049047289132892707168355320123411679019063762394574858184004798391424529343061153832376815931856720568791666912695347000672793172269950595017091646340785048993078241224161252001148073547489046685826825508272856624980113062052691812811148389809285914154789134417253541532446394364389041123905539364068912182513149303934932461093794444444897829033430051356616780134229088450684193970352707805474621680929832096155556294223468204822863013503570920014905467452606713427213789545368433226380420995209
